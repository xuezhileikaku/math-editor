function MarkdownParser(u){var e=this;u=u?"i":"";var h,f=null,m=null,l={},g={},i={},v={},w={},c={},k={};function S(e,t){for(var n in t)if(t.hasOwnProperty(n)&&t[n].test(e))return n;return""}return e.addInlineRules=function(e){var t,n,r,a=[];for(var o in e){e.hasOwnProperty(o)&&(t=e[o].source,a.push(t),n=o,r=void 0,r=new RegExp("^("+t+")$",u),l[n]=r,i[n]=r)}return f=new RegExp("("+a.join("|")+")",u),this},e.addSubRules=function(e){for(var t in h=e)if(e.hasOwnProperty(t)){var n,r=e[t],a=[];for(var o in r){r.hasOwnProperty(o)&&(n=r[o].source,l=n,i=o,c[s=t]||(c[s]={}),c[s][i]=new RegExp("^("+l+")$",u),a.push(n))}k[t]=new RegExp("("+a.join("|")+")",u)}var l,i,s;return this},e.addBlockRules=function(e){var t,n,r,a=[];for(var o in e){e.hasOwnProperty(o)&&(t=e[o].source,a.push(t),n=o,r=void 0,r=new RegExp("^("+t+")$",u),l[n]=r,g[n]=r)}return m=new RegExp("("+a.join("|")+")",u),this},e.addRunIn=function(e){return v=e,this},e.addMarkers=function(e){return w=e,this},e.tokenize=function(e){for(var t,n=[],r=[],a=(e=e.replace("\r","")).split(m),o=a.length,l=0,i=0;i<o;i++)if(""!==a[i]){var s=S(a[i],g);if(0<l&&s in v){var u=v[s].allowedBlocks;if(u&&0<=u.indexOf(t)){a[l]+=a[i],a[i]="",r[i]="";continue}}t=r[l=i]=s}var c=0;for(i=0;i<o;i++){var d,p=a[i];""!==p&&(d=0,"empty"!=r[i]&&(d=c,c=0),function(e,t,n,r){var a,o=f;if(t in h){if(null===h[t])return r.push({token:e,block:t,line:n});o=k[t]}void 0===w[t]||(a=e.match(w[t]))[2]&&(r.push({token:a[1],block:t+"-mark",line:n}),e=a[2],n=0);for(var l,i=e.split(o),s=0;s<i.length;s++)""!=(l=i[s])&&(r.push({token:l,block:t,line:n}),n=0)}(p,r[i],d,n),c+=substrCount("\n",p))}return n},e.identifyInline=function(e){var t=e.block,n=i;if(t in h){if(null===h[t])return"";n=c[t]}return S(e.token,n)},e}!function(m,g){"use strict";var v={html:!0,xhtmlOut:!1,breaks:!1,langPrefix:"language-",linkify:!0,typographer:!0,quotes:"\"\"''",_habr:{protocol:""},_highlight:!0,_strict:!1};function w(e){var t=m.body;["result-as-html","result-as-htmltex","result-as-habr","result-as-src","result-as-debug"].forEach(function(e){t.classList?t.classList.remove(e):t.className=t.className.replace(new RegExp("(^|\\b)"+e.split(" ").join("|")+"(\\b|$)","gi")," ")}),t.classList?t.classList.add("result-as-"+e):t.className+=" result-as-"+e}function k(e,n,t,r,a,o,l,i,s){var u=t(e).use(markdownitS2Tex).use(markdownitSub).use(markdownitSup),c=t(e).use(markdownitS2Tex).use(markdownitSub).use(markdownitSup),d=t(e).use(markdownitS2Tex,{noreplace:!0}).use(markdownitSub).use(markdownitSup),p=t(e).use(markdownitS2Tex,e._habr).use(markdownitSub).use(markdownitSup),h=t("zero").use(markdownitS2Tex);function f(e,t){if(0<=t&&e[t]&&e[t].children)for(var n=e[t].children.length;n--;)if("tex-block"===e[t].children[n].tag)return 1}u.renderer.rules.paragraph_open=u.renderer.rules.heading_open=function(e,t,n,r,a){var o;return e[t].map&&0===e[t].level&&(o=e[t].map[0],e[t].attrPush(["class","line"]),e[t].attrPush(["data-line",o+""])),f(e,t+1)&&e[t].attrPush(["align","center"]),a.renderToken(e,t,n,r,a)},c.renderer.rules.paragraph_open=c.renderer.rules.heading_open=function(e,t,n,r,a){return f(e,t+1)&&e[t].attrPush(["align","center"]),a.renderToken(e,t,n,r,a)},p.renderer.rules.heading_open=function(e,t,n,r,a){var o="";return 0<t&&"paragraph_close"===e[t-1].type&&!f(e,t-2)&&(o="\n"),o+a.renderToken(e,t,n,r,a)},p.renderer.rules.paragraph_open=function(e,t,n,r,a){var o="";return 0<t&&"paragraph_close"===e[t-1].type&&!f(e,t-2)&&(o="\n"),o},p.renderer.rules.paragraph_close=function(e,t,n,r,a){return"\n"},h.inline.ruler.before("backticks","backticks2",function(e,t){var n,r,a,o,l,i,s=e.pos;if(96!==e.src.charCodeAt(s))return!1;for(n=s,s++,r=e.posMax;s<r&&96===e.src.charCodeAt(s);)s++;for(a=e.src.slice(n,s),l=s;-1!==(o=e.src.indexOf("`",l));){for(l=o+1;l<r&&96===e.src.charCodeAt(l);)l++;if(l-o===a.length)return t||((i=e.push("backticks2_inline","code",0)).markup=a,i.content=e.src.slice(s,o)),e.pos=l,!0}return t||(e.pending+=a),e.pos+=a.length,!0}),h.renderer.rules.backticks2_inline=function(e,t){var n=e[t];return n.markup+n.content+n.markup},h.renderer.rules.text=function(e,t){return e[t].content},u.renderer.rules.math_inline=function(e,t){return n.getHtmlStub(e[t].content)},d.renderer.rules.math_number=function(e,t){return e[t].content},p.renderer.rules.math_number=function(e,t){return'<img align="right" src="//i.upmath.me/svg/'+e[t].content+'" />'},p.renderer.rules.fence=function(e,t,n,r,a){var o,l=e[t],i=l.info?p.utils.unescapeAll(l.info).trim():"",s="";return i&&(s=i.split(/\s+/g)[0],l.attrPush(["lang",s])),o=n.highlight&&n.highlight(l.content,s)||p.utils.escapeHtml(l.content),"\n<source"+a.renderAttrs(l)+">"+o+"</source>\n"},this.getSource=a,this.setSource=function(e){o(e),this.updateResult()};var m=null,g="html";this.updateResult=function(){var e,t=a();m!==t&&(m=t,"html"===g?(n.reset(),l(u.render(t)),n.fixDom()):"htmltex"===g?i("result-src-content",'<script src="https://i.upmath.me/latex.js"><\/script>\n'+d.render(t),"html"):"debug"===g?i("result-src-content",JSON.stringify(c.parse(t,{references:{}}),null,2),"json"):i("result-src-content","habr"===g?(e=t,p.render(e).replace("<spoiler ","\n<spoiler ")):"md"===g?h.renderInline(t):c.render(t),"html"),s(t))},this.getDisplayedResult=function(){var e=a();return"habr"===g?p.render(e):"htmltex"===g?'<script src="https://i.upmath.me/latex.js"><\/script>\n'+d.render(e):"md"===g?h.renderInline(e):c.render(e)},this.getDisplayedResultFilename=function(){return g+".html"},r(g),this.switchView=function(e){r(g=e),m=null,this.updateResult()}}function S(e,t,n){var r=m.getElementsByClassName(e)[0];g.hljs?r.innerHTML=g.hljs.highlight(n,t).value:r.textContent=t}function b(e){m.getElementsByClassName("result-html")[0].innerHTML=e}function y(){for(var e=m.querySelectorAll(".result-html .line"),t=[],n=[0],r=[0],a=0,o=e.length;a<o;a++)(i=parseInt(e[a].getAttribute("data-line")))&&(t[i]=Math.round(e[a].offsetTop));for(var l=m.querySelectorAll(".ldt-pre .block-start"),o=l.length,i=0,a=0;a<o;a++){var s=parseInt(l[a].getAttribute("data-line"));s&&void 0!==t[i+=s]&&(n.push(l[a].offsetTop),r.push(t[i]))}var u=m.querySelector(".ldt-pre").scrollHeight,c=n[n.length-1];return n.push(c<u-5?u-5:c),r.push(m.querySelector(".result-html").scrollHeight),[n,r]}documentReady(function(){var t=m.getElementById("editor-source"),n=m.getElementsByClassName("result-html")[0],r=debounce(function(){c.recalcHeight()},100),a=new ScrollMap(y),o=new k(v,new ImageLoader(new ImagePreloader,"https:"===location.protocol?"https:":"http:"),g.markdownit,w,function(){return t.value},function(e){t.value=e,c.update()},b,S,function(e){a.reset();try{localStorage.setItem("editor_content",e)}catch(e){}});o.updateResult();var l,e,i,s,u,c=new TextareaDecorator(t,mdParser),d=m.getElementsByClassName("source")[0],p=new SyncScroll(a,new Animator(function(){return d.scrollTop},function(e){d.scrollTop=e}),new Animator(function(){return n.scrollTop},function(e){n.scrollTop=e}),d,n,m.querySelector('[id^="container-block"]')),h=debounce(o.updateResult,300,{maxWait:3e3});function f(e){s.style.width="calc("+e+"% - 3px)",u.style.width="calc("+(100-e)+"% - 3px)",a.reset(),r()}t.addEventListener("keyup",h),t.addEventListener("paste",h),t.addEventListener("cut",h),t.addEventListener("mouseup",h),t.addEventListener("touchstart",p.switchScrollToSrc),t.addEventListener("mouseover",p.switchScrollToSrc),n.addEventListener("touchstart",p.switchScrollToResult),n.addEventListener("mouseover",p.switchScrollToResult),p.switchScrollToSrc(),Array.prototype.forEach.call(m.getElementsByClassName("control-item"),function(e,t){e.addEventListener("click",function(){var e,t=this.getAttribute("data-result-as");t&&(o.switchView(t),"preview"===t||(e=m.getElementsByClassName("result-src-content")).length&&setTimeout(function(){selectText(e[0])},0))})}),m.querySelector("._download-source").addEventListener("click",function(){var e=new Blob([o.getSource()],{type:"text/markdown;charset=utf-8"});saveAs(e,"source.md")}),m.querySelector("._download-result").addEventListener("click",function(){var e=new Blob([o.getDisplayedResult()],{type:"text/html;charset=utf-8"});saveAs(e,o.getDisplayedResultFilename())}),m.querySelector("._upload-source").addEventListener("click",function(){var e=m.getElementById("fileElem");(e.onclick||e.click||function(){}).call(e)}),m.getElementById("fileElem").addEventListener("change",function(){var e,t;this.files&&FileReader&&(e=new FileReader,t=this,e.onload=function(){o.setSource(this.result),t.value=t.defaultValue},e.readAsText(this.files[0]))}),e=m.querySelector(".slider"),i=new Draggabilly(e,{axis:"x"}),s=m.getElementById("source-block"),u=m.getElementById("result-block"),e.addEventListener("dblclick",function(){f(50)}),i.on("dragStart",function(e,t,n){l=g.innerWidth}),i.on("dragMove",function(e,t,n){f(100*t.pageX/l)}),g.addEventListener("resize",function(){a.reset(),r()})})}(document,window),function(){"use strict";function h(e,t){var n,r,a,o,l,i,s=e.pos,u=!0,c=!0,d=e.posMax,p=e.md.utils.isWhiteSpace,h=e.md.utils.isPunctChar,f=e.md.utils.isMdAsciiPunct,m=0<t?e.src.charCodeAt(t-1):32;return d<=s&&(u=!1),r=s-t,n=s<d?e.src.charCodeAt(s):32,o=f(m)||h(String.fromCharCode(m)),i=f(n)||h(String.fromCharCode(n)),a=p(m),(l=p(n))?u=!1:i&&(a||o||(u=!1)),a?c=!1:o&&(l||i||(c=!1)),{can_open:u,can_close:c,delims:r}}window.markdownitS2Tex=function(a,o){var d,p,l,i=(o="object"==typeof o?o:{}).inlineOpen||"$$",s=o.inlineClose||"$$",e=(d=i,p=s,function(e,t){var n,r,a,o,l=e.posMax,i=e.pos;if(e.src.slice(i,i+d.length)!==d)return!1;if(t)return!1;if(n=(a=h(e,i+d.length)).delims,!a.can_open)return e.pos+=n,e.pending+=e.src.slice(i,e.pos),!0;for(e.pos=i+d.length;e.pos<l;){if(e.src.slice(e.pos,e.pos+p.length)===p&&h(e,e.pos+p.length).can_close){r=!0;break}e.md.inline.skipToken(e)}if(!r)return e.pos=i,!1;var s,u=!1,c="tex-inline";return 0==i&&(!(u=(s=e.src.substring(e.pos+p.length)).match(/^\s*(\([ \t]*\S+[ \t]*\))\s*$/))&&""!=s||(c="tex-block")),e.posMax=e.pos,e.pos=i+p.length,(o=e.push("math_inline",c,0)).content=e.src.slice(e.pos,e.posMax),o.markup=d,e.pos=u?l:e.posMax+p.length,e.posMax=l,u&&((o=e.push("math_number","tex-number",0)).content=u[1],o.markup="()"),!0});a.inline.ruler.before("escape","math_inline",e),a.renderer.rules.math_inline=(l="https:"==location.protocol?"https:":"http:",l=void 0!==o.protocol?o.protocol:l,function(e,t){var n=e[t].content;if(o.noreplace)return(i+n+s).replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;").replace(/"/g,"&quot;");var r=l+"//i.upmath.me/svg/"+encodeURIComponent(n);return"tex-inline"===e[t].tag?'<img src="'+r+'" alt="'+a.utils.escapeHtml(n)+'" />':'<img align="center" src="'+r+'" alt="'+a.utils.escapeHtml(n)+'" />'}),a.renderer.rules.math_number=function(e,t){return'<span style="float:right">'+e[t].content+"</span>"}}}();var mdParser=new MarkdownParser;function documentReady(e){"loading"!=document.readyState?e():document.addEventListener("DOMContentLoaded",e)}function findBisect(e,t){var n=0,r=t.length-1,a=t[n];if(e<=a)return{val:n,part:0};var o=t[r];if(o<e)return{val:r,part:0};for(;1<r-n;){var l=n+Math.round((r-n)/2),i=t[l];e<=i?(r=l,o=i):(n=l,a=i)}return{val:n,part:(e-a)/(o-a)}}function substrCount(e,t){for(var n=-1,r=-2;-1!=r;)n++,r=t.indexOf(e,r+1);return n}function selectText(e){var t,n;window.getSelection&&(t=window.getSelection(),(n=document.createRange()).selectNodeContents(e),t.removeAllRanges(),t.addRange(n))}function Animator(t,n){var r,o,l,i,a,s=0,u=0,c=0,d=0,p=null,h=function(e){null===p&&(p=e);var t=e-p;t<o?(s=c+l*(Math.cos(i*(t-o))-1),d=l*i*Math.sin(i*(o-t)),n(s),r=requestAnimationFrame(h),f&&(m(a,s),f=!1,p=e)):(p=null,d=0,n(c),cancelAnimationFrame(r),f=f&&!1)},f=!1;function m(e,t){var n,r,a;c=e,u=t,o=Math.abs(d)<1e-5?(r=Math.PI,200):(r=(n=(c-u)/d/200)<0||.5<n?Math.PI*Math.sqrt(1-.5/n):.1,a=(1-Math.cos(r))/r/Math.sin(r),(c-u)/a/d),i=r/o,l=(c-u)/(1-Math.cos(r))}this.setPos=function(e){(f=null!==p)?a=e:(m(e,s=t()),r=requestAnimationFrame(h))},this.stop=function(){p=null,d=0,cancelAnimationFrame(r),f=!1}}function escapeRegExp(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function ImagePreloader(){var o={},l=0;function a(){var e=200<=this.status&&this.status<400?this.responseText:'<svg height="24" version="1.1" width="24" xmlns="http://www.w3.org/2000/svg"><g transform="translate(0 -1028.4)"><path d="m22 12c0 5.523-4.477 10-10 10-5.5228 0-10-4.477-10-10 0-5.5228 4.4772-10 10-10 5.523 0 10 4.4772 10 10z" fill="#742600" transform="translate(0 1029.4)"/><path d="m22 12c0 5.523-4.477 10-10 10-5.5228 0-10-4.477-10-10 0-5.5228 4.4772-10 10-10 5.523 0 10 4.4772 10 10z" fill="#AB562B" transform="translate(0 1028.4)"/><path d="m7.0503 1037.8 3.5357 3.6-3.5357 3.5 1.4142 1.4 3.5355-3.5 3.536 3.5 1.414-1.4-3.536-3.5 3.536-3.6-1.414-1.4-3.536 3.5-3.5355-3.5-1.4142 1.4z" fill="#742600"/><path d="m7.0503 1036.8 3.5357 3.6-3.5357 3.5 1.4142 1.4 3.5355-3.5 3.536 3.5 1.414-1.4-3.536-3.5 3.536-3.6-1.414-1.4-3.536 3.5-3.5355-3.5-1.4142 1.4z" fill="#ecf0f1"/></g></svg>';t(this.responseURL||this.s2Url,e)}this.onLoad=function(e,t){var n,r;o[e]?null!==o[e].svg&&t(e,o[e].svg,o[e].baseline):o[e]={svg:null,baseline:null,request:(n=e,(r=new XMLHttpRequest).open("GET",n,!0),r.s2Url=n,r.onload=a,r.onerror=function(){},r.send(),r),callback:t}};var t=function(e,t){var n,r,a=o[e];a&&(r=(n=(t=function(e){var t=e.match(/id=["']([^"']*)["']/g);if(!t)return e;for(var n,r,a,o=t.length;o--;)n=(a=t[o]).match(/id=["']([^"']*)["']/)[1],r="s"+l+n,e=e.replaceAll(a,'id="'+r+'"').replaceAll("#"+n,"#"+r);return l++,e}(t)).match(/postMessage\((?:&quot;|")([\d\|\.\-eE]*)(?:&quot;|")/))?n&&n[1]?n[1].split("|").shift():0:null,a.callback(e,t,r),a.svg=t,a.baseline=r,a.request=null,a.callback=null)};this.getImageDataFromUrl=function(e){var t=o[e];return t||null}}function ImageLoader(n,r){var a=[],o=[],l={},i=0,d=null,s=null,u=null;this.reset=function(){a=[],i=0};function c(e,t,n){var r,a=l[e];if(a&&(r=a.length))for(;r--;){var o=a[r];p(o,t,n,o===s?"fade-in":"replace"),o===s&&(clearTimeout(d),u=s=null)}}function p(e,t,n,r){var a="s2tex_"+e,o=document.getElementById(a),l=o.parentNode,i="fade-out"==r?"0.5":"1",s='<svg class="svg-preview" id="'+a+'" ';s+=null===n?'width="13px" height="13px" ':'style="vertical-align:'+-n+'pt; opacity: 1" ';var u=document.createElement("div");u.innerHTML=t.replace("<svg ",s);var c=u.firstElementChild;u.removeChild(c),l.insertBefore(c,o),l.removeChild(o),"1"!=i&&(d=setTimeout(function(){document.getElementById(a).style.opacity=i},0))}this.getHtmlStub=function(e){a[i]=r+"//i.upmath.me/svg/"+encodeURIComponent(e);var t='<span id="s2tex_'+i+'"></span>';return i++,t},this.fixDom=function(){!function(){if(i==o.length){for(var e,t=0,n=i;n--;)a[n]!=o[n]&&(t++,e=n);if(1==t){if(null===s)return u=o[s=e];if(s===e)return}}u=s=null}(),function(){l={};for(var e=i;e--;){var t=a[e];void 0===l[t]?l[t]=[e]:l[t].push(e)}}();for(var e,t=i;t--;)n.onLoad(a[t],c);null===s||null!==(e=n.getImageDataFromUrl(u))&&null===e.callback&&p(s,e.svg,e.baseline,"fade-out"),o=a.slice(0)}}function ScrollMap(u){var c=null;this.reset=function(){c=[null,null]},this.getPosition=function(e,t,n){var r=e.offsetHeight,a=e.scrollTop;if(0==a)return 0;null===c[t]&&(c=u());var o=c[t].length-1;if(c[t][o]<=a+r)return c[n][o]-r;var l=r/2,i=findBisect(a+l,c[t]),s=parseFloat(c[n][i.val]*(1-i.part));return c[n][i.val+1]&&(s+=parseFloat(c[n][i.val+1]*i.part)),s-l}}function SyncScroll(e,t,n,r,a,o){function l(){n.setPos(e.getPosition(r,0,1))}function i(){t.setPos(e.getPosition(a,1,0))}this.switchScrollToSrc=function(){a.removeEventListener("scroll",i),r.removeEventListener("scroll",l),r.addEventListener("scroll",l),o.id="container-block-source"},this.switchScrollToResult=function(){r.removeEventListener("scroll",l),a.removeEventListener("scroll",i),a.addEventListener("scroll",i),o.id="container-block-result"}}mdParser.addBlockRules({latexBlock:/[ \t]*\$\$\n?(?:[^\n]+\n)*(?:[^\n]*[^\\\n])?\$\$(?:[ \t]*\([ \t]*\S+[ \t]*\))?[ \t]*(?:\n|$)/,empty:/(?:[ \t]*\n)+/,fence:/```[\s\S]*?(?:$|```(?:\n|$))/,reference:/\[[^\]]+\]\:[^\n]*(?:\n|$)/,header:/#{1,6} [^\n]*(?:\n|$)/,header2:/[^\n]+\n[ \t]*[=-]{2,}(?:\n|$)/,rule:/(?:[\*]{3,}|[\-]{3,}|[\_]{3,})(?:\n|$)/,list:/[ ]{0,3}(?:[+\-\*]|\d+\.)[ \t]+[^\n]*(?:\n[ \t]*[^\n\t ]+[ \t]*)*(?:\n|$)/,quote:/[ ]{0,3}>[^\n]*(?:\n|$)/,paragraph:/[\s\S]*?(?:\n|$)/}).addInlineRules({latex:/\$\$(?:[\s\S]*?[^\\])?\$\$/,link:/\[.+?\][\(\[].*?[\)\]]/,bold:/(?:\s|^)__[\s\S]*?\S__|\*\*[\s\S]*?\S\*\*/,italic:/(?:\s|^)_[\s\S]*?[^\\\s]_|\*[^\\\s]\*|\*\S[\s\S]*?[^\\\s]\*/,strike:/~~.+?~~/,sup:/\^.+?\^/,sub:/~.+?~/,code:/``.+?``|`.*?[^`\\]`(?!`)/}).addSubRules({fence:null,rule:null,latexBlock:{comment:/%[^\n]*?(?=\$\$)|%[^\n]*/,reference:/[ \t]*\([ \t]*\S+[ \t]*\)[ \t\n]*$/,index:/(?:\^|_)(?:\\[a-zA-Zа-яА-я]+[\*]?(?:\{.*?\})|\{[a-zA-Zа-яА-я0-9]*?\}|[a-zA-Zа-яА-я0-9])/,bracket:/(?:(?:\\left|\\right)?[\{\}\[\]\(\)\|])/,keyword:/\\[a-zA-Zа-яА-я]+[\*]?/,keyword2:/\\[^a-zA-Zа-яА-я0-9]/,keyword3:/&/,delimeter:/\$\$/}}).addRunIn({paragraph:{allowedBlocks:["paragraph","quote","list"]}}).addMarkers({list:/^([ ]{0,3}(?:[+\-\*]|\d+\.)[ \t]+)([\s\S]*)$/,quote:/^([ ]{0,3}(?:>[ \t]*)+)([\s\S]*)$/}),String.prototype.replaceAll=function(e,t){return this.replace(new RegExp(escapeRegExp(e),"g"),t)};var now=Date.now||function(){return(new Date).getTime()};function debounce(r,a,e){var o,l,i,s,u,c,d,p=0,h=!1,f=!1,m=!0;if("function"!=typeof r)throw new TypeError(FUNC_ERROR_TEXT);function t(e,t){t&&clearTimeout(t),l=c=d=void 0,e&&(p=now(),i=r.apply(u,o),c||l||(o=u=void 0))}function g(){var e=a-(now()-s);e<=0||a<e?t(d,l):c=setTimeout(g,e)}function v(){t(m,c)}function n(){var e,t,n;return o=arguments,s=now(),u=this,d=m&&(c||!h),!1===f?e=h&&!c:(l||h||(p=s),(n=(t=f-(s-p))<=0||f<t)?(l=l&&clearTimeout(l),p=s,i=r.apply(u,o)):l=l||setTimeout(v,t)),n&&c?c=clearTimeout(c):c||a===f||(c=setTimeout(g,a)),e&&(n=!0,i=r.apply(u,o)),!n||c||l||(o=u=void 0),i}return a=!(a<0)&&+a||0,"object"==typeof e&&(h=!!e.leading,f="maxWait"in e&&Math.max(+e.maxWait||0,a),m="trailing"in e?!!e.trailing:m),n.cancel=function(){c&&clearTimeout(c),l&&clearTimeout(l),l=c=d=void(p=0)},n}